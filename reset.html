<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cache Reset</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif;background:#0b0b0f;color:#fff;margin:0;padding:18px}
    .box{max-width:860px;margin:0 auto;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:14px;padding:16px}
    button{border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.10);color:#fff;border-radius:12px;padding:10px 12px;cursor:pointer}
    pre{white-space:pre-wrap;background:rgba(0,0,0,.35);padding:10px;border-radius:12px}
  </style>
</head>
<body>
  <div class="box">
    <h2>Cache Reset</h2>
    <p>Service Worker と Cache Storage を掃除します（黒画面対策）。</p>
    <button id="go">実行</button>
    <pre id="log"></pre>
  </div>
  <script>
  const log = (t)=>{document.getElementById("log").textContent += t+"\n";}
  document.getElementById("go").onclick = async () => {
    try{
      if ('serviceWorker' in navigator) {
        const regs = await navigator.serviceWorker.getRegistrations();
        for (const r of regs) { await r.unregister(); }
        log("SW: unregistered ("+regs.length+")");
      } else {
        log("SW: not supported");
      }
      if (window.caches) {
        const keys = await caches.keys();
        await Promise.all(keys.map(k=>caches.delete(k)));
        log("CacheStorage: deleted ("+keys.length+")");
      } else {
        log("CacheStorage: not available");
      }
      log("Done. Going back to / in 800ms...");
      setTimeout(()=>location.href="./", 800);
    }catch(e){
      log("ERROR: "+(e && (e.stack||e.message) || e));
    }
  };
  </script>
</body>
</html>
