<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b0b0f" />
  <title>Mandelbrot Explorer v9.6.13</title>
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="favicon.ico" />
  <style>
    html,body{margin:0;height:100%;background:#0b0b0f;overflow:hidden}
    canvas{touch-action:none;display:block;width:100vw;height:100vh}
    
    .hud {
      position:fixed;left:12px;top:12px;z-index:20;
      padding:10px 12px;border-radius:12px;
      background:rgba(0,0,0,.45);color:rgba(255,255,255,.88);
      font:12px/1.35 ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;
      user-select:none;pointer-events:none;white-space:pre-wrap;
      backdrop-filter: blur(10px);
      max-width:min(680px,calc(100vw - 24px));
    }
    .panel {
      position:fixed;right:12px;top:12px;z-index:30;
      width:min(430px,calc(100vw - 24px));
      padding:10px 12px;border-radius:14px;
      background:rgba(0,0,0,.45);color:rgba(255,255,255,.9);
      font:12px/1.35 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif;
      backdrop-filter: blur(10px);
      box-shadow: 0 6px 30px rgba(0,0,0,.35);
    }
    .row{display:flex;gap:10px;align-items:center;justify-content:space-between;margin:6px 0}
    .row label{opacity:.9}
    .row input[type="range"]{width:220px}
    .row input[type="number"], .row select{
      width:150px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.14);
      border-radius:10px;color:#fff;padding:6px 8px;outline:none;
      font:12px ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;
    }
    .btns{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    button{
      border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.10);
      color:#fff;border-radius:12px;padding:8px 10px;cursor:pointer;
      font:12px system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif;
    }
    button:hover{background:rgba(255,255,255,.14)}
    .hint{opacity:.8;margin-top:8px}
    #errBox{
      position:fixed;left:12px;right:12px;bottom:12px;z-index:99999;
      background:rgba(140,0,0,.88);color:#fff;border-radius:14px;
      padding:10px 12px;display:none;white-space:pre-wrap;
      font:12px/1.35 ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;
      max-height:40vh;overflow:auto;
    }
    
    .helpOverlay {
      position:fixed; inset:0; display:none; z-index:9999;
      background:rgba(0,0,0,0.70);
      backdrop-filter: blur(3px);
      align-items: center;
      justify-content: center;
    }
    .helpOverlay.show { display: flex; }
    
    .helpCard {
      position:relative; 
      width:min(720px, calc(100vw - 24px));
      background:#111; color:#eee; border:1px solid #333;
      border-radius:14px; padding:18px 18px 14px;
      box-shadow: 0 18px 60px rgba(0,0,0,0.55);
    }
    .card {
      background:#151515; border:1px solid #2a2a2a; border-radius:12px;
      padding:10px 12px; line-height:1.35; margin-bottom: 8px;
    }
    .k {
      border:1px solid #3a3a3a; background:#1b1b1b; color:#eee;
      border-radius:10px; padding:2px 6px; margin-right: 6px; font-weight: bold;
    }

    /* DEEPNAV BADGE - ä½ç½®ã‚’ç”»é¢ä¸‹éƒ¨ã¸ç§»å‹• */
    #deepBadge{
      position:fixed; 
      /* top: 12px;  <-- å‰Šé™¤ */
      bottom: 100px; /* <-- å¤‰æ›´: ä¸‹ã‹ã‚‰100pxã®ä½ç½®ã¸ */
      left: 50%; 
      transform: translateX(-50%);
      z-index:9998;
      font: 700 12px/1.0 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      letter-spacing: .08em;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.35);
      color:#cfcfcf;
      user-select:none;
      pointer-events:none;
      text-transform: uppercase;
      white-space: nowrap;
    }
    #deepBadge.on{ background: rgba(30,140,60,0.32); color:#eaffef; border-color: rgba(60,255,120,0.35); }
    #deepBadge.standby{ background: rgba(0,0,0,0.35); color:#d9d9d9; border-color: rgba(255,255,255,0.18); }
    #deepBadge.off{ background: rgba(140,30,30,0.32); color:#ffecec; border-color: rgba(255,120,120,0.35); }
    
    #toast{
      position:fixed; left:50%; top:50px; transform:translateX(-50%);
      z-index:9999;
      padding:10px 14px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.55);
      color:#fff;
      font: 600 13px/1.2 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      letter-spacing: .02em;
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease;
      white-space: nowrap;
    }
    #toast.show{ opacity: 1; }

    .pill{padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.06);color:#fff;font-weight:700;cursor:pointer}
    .pill:active{transform:translateY(1px)}
    .tiny{font-size:12px;opacity:.75}
    
    .hidden { display: none !important; }

    /* MOBILE_FAB */
    #mobileFab{
      position:fixed;
      left:12px;
      bottom: calc(12px + env(safe-area-inset-bottom));
      display:none;
      gap:10px;
      z-index:2147483600;
    }
    #mobileFab .fab{
      width:48px; height:48px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.55);
      color:#fff;
      font:800 18px/1 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      display: flex; align-items: center; justify-content: center;
    }
    #mobileFab .fab:active{ transform: translateY(1px); }

    @media (max-width: 520px){
      #mobileFab{ display:flex; }
    }

    /* ? Button (Always Visible) */
    #fabPanel{
      position:fixed;
      right:12px;
      bottom: calc(12px + env(safe-area-inset-bottom));
      width:48px; height:48px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.55);
      color:#fff;
      font:900 18px/1 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto;
      z-index:2147483601;
      display:block; /* Always show help button */
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      cursor: pointer;
    }
    #fabPanel:active{ transform: translateY(1px); }
  </style>
</head>
<body>

<canvas id="c"></canvas>
<div id="hud" class="hud"></div>
<div id="deepBadge" class="off">DEEPNAV OFF</div>
<div id="toast"></div>

<div id="uiPanel" class="panel">
  <div class="kidsTop">
    <div class="kidsTitle">Mandelbrot Explorer</div>
    <div class="kidsSub">UltraDeep v9.6.13</div>
  </div>
  
  <div class="row">
    <label>ã‚¹ãƒãƒ›ãƒ¢ãƒ¼ãƒ‰</label>
    <div class="ctrl">
      <button id="mobileModeBtn" class="pill" title="ã‚¹ãƒãƒ›å‘ã‘è»½é‡è¨­å®š">OFF</button>
      <span class="tiny">ï¼ˆè»½ãå‹•ãï¼‰</span>
    </div>
  </div>
  
  <div class="row">
    <label>æ“ä½œ</label>
    <div class="ctrl">
       <button id="resetBtn" class="pill">Reset</button>
       <button id="panelCamBtn" class="pill" style="font-weight:bold; color:#88ffbb; border-color:#88ffbb;">ğŸ“· æ’®å½±</button>
    </div>
  </div>

  <div class="row">
    <label>ã‚ºãƒ¼ãƒ </label>
    <div class="ctrl">
      <button id="zoomOutBtn" class="pill" title="ã‚ºãƒ¼ãƒ ã‚¢ã‚¦ãƒˆ">âˆ’</button>
      <button id="zoomInBtn" class="pill" title="ã‚ºãƒ¼ãƒ ã‚¤ãƒ³">ï¼‹</button>
    </div>
  </div>

  <div class="row">
     <label>DeepNav</label>
     <div class="ctrl">
       <button id="deepBtn" class="pill">DeepNav</button>
       <label class="chk"><input type="checkbox" id="deepAlways">å¸¸æ™‚ON</label>
     </div>
  </div>

  <details class="advanced">
    <summary>è©³ç´°è¨­å®š</summary>
    <div class="row"><label>Res</label><input id="res" type="number" step="0.05" value="0.70"></div>
    <div class="row"><label>Step</label><input id="step" type="number" value="2"></div>
    <div class="row"><label>Iter</label><input id="iterCap" type="number" value="1400"></div>
    <div class="row"><label>Bits</label><input id="bits" type="number" value="512"></div>
    <div class="row"><label>AutoBits</label><input type="checkbox" id="autoBits" checked></div>
    <div class="row"><label>Preview</label><input type="checkbox" id="preview" checked></div>
    <div class="row"><label>AutoSettle</label><input type="checkbox" id="autoSettle" checked></div>
  </details>
  
  <button id="panelCloseEl" class="pill" style="margin-top:10px;width:100%">é–‰ã˜ã‚‹</button>
</div>

<div id="errBox"></div>

<div id="mobileFab" aria-hidden="false">
  <button id="fabZoomOut" class="fab" title="ã‚ºãƒ¼ãƒ ã‚¢ã‚¦ãƒˆ">âˆ’</button>
  <button id="fabZoomIn" class="fab" title="ã‚ºãƒ¼ãƒ ã‚¤ãƒ³">ï¼‹</button>
  <button id="fabCam" class="fab" title="æ’®å½±" style="font-size:22px;">ğŸ“·</button>
</div>

<button id="fabPanel" title="æ“ä½œãƒ‘ãƒãƒ«" aria-label="æ“ä½œãƒ‘ãƒãƒ«">ï¼Ÿ</button>

<div id="helpOverlay" class="helpOverlay" aria-hidden="true">
  <div class="helpCard" role="dialog" aria-modal="true" aria-label="ã¤ã‹ã„ã‹ãŸ">
    <button id="helpClose" class="helpClose" aria-label="é–‰ã˜ã‚‹" style="position:absolute;right:10px;top:10px;padding:8px;">Ã—</button>
    <div class="helpTitle" style="font-size:18px;font-weight:bold;margin-bottom:12px">ã¤ã‹ã„ã‹ãŸ</div>
    <div class="helpBody">
      <div class="card"><div><span class="k">ãƒ‰ãƒ©ãƒƒã‚°</span>ç§»å‹•ï¼ˆãƒ‘ãƒ³ï¼‰</div></div>
      <div class="card"><div><span class="k">ã‚¯ãƒªãƒƒã‚¯</span>ä¸­å¿ƒåˆã‚ã›</div><div><span class="k">ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯</span>ä¸­å¿ƒåˆã‚ã›ï¼‹ã‚ºãƒ¼ãƒ ã‚¤ãƒ³</div></div>
      <div class="card"><div><span class="k">ğŸ“· æ’®å½±</span>ç¾åœ¨ã®ç”»é¢ã‚’é«˜ç”»è³ªã§ç”»åƒä¿å­˜</div></div>
      <div class="card"><div><span class="k">DeepNav</span>è¶…æ·±åº¦å¯¾å¿œãƒ¢ãƒ¼ãƒ‰</div><div><span class="k">Reset</span>åˆæœŸä½ç½®ã¸</div></div>
      <div style="margin-top:10px;font-size:12px;opacity:0.8">
        <b>ã‚¹ãƒãƒ›</b>ï¼šï¼‹ï¼âˆ’ã§ã‚ºãƒ¼ãƒ ï¼1æœ¬æŒ‡ãƒ‰ãƒ©ãƒƒã‚°ã§ç§»å‹•<br>
        <b>PC</b>ï¼šãƒ›ã‚¤ãƒ¼ãƒ«ã§ã‚ºãƒ¼ãƒ ï¼å·¦ãƒ‰ãƒ©ãƒƒã‚°ã§ç§»å‹•
      </div>
    </div>
  </div>
</div>

<script>
  (function(){
    const errBox = document.getElementById('errBox');
    function showErr(t){
      if(errBox) {
          errBox.style.display='block';
          errBox.textContent = t;
      }
    }
    window.addEventListener('error', (e)=> showErr('[window.error]\n'+e.message));
    window.addEventListener('unhandledrejection', (e)=> showErr('[unhandledrejection]\n'+e.reason));

    const build = '20251214_v9_' + Date.now().toString(36);
    const s = document.createElement('script');
    s.src = './app.js?v=' + build; 
    s.defer = true;
    document.head.appendChild(s);
  })();

  (() => {
    const btn = document.getElementById('fabPanel');
    const ov = document.getElementById('helpOverlay');
    const close = document.getElementById('helpClose');
    if (!btn || !ov) return;
    const hide = () => { ov.classList.remove('show'); ov.setAttribute('aria-hidden','true'); };
    const show = () => { ov.classList.add('show'); ov.setAttribute('aria-hidden','false'); };
    btn.addEventListener('click', (e) => {
      e.preventDefault(); e.stopPropagation();
      show();
    });
    if (close) close.addEventListener('click', (e) => {
      e.preventDefault(); e.stopPropagation();
      hide();
    });
    ov.addEventListener('click', (e) => {
      if (e.target === ov) hide();
    });
  })();
</script>

</body>
</html>